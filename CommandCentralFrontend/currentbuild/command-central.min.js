/*! command-central 2016-09-30 */
"use strict";angular.module("Connection",[]),angular.module("Authentication",["Authorization","angularModalService","Modals","Profiles","Connection"]),angular.module("Authorization",["Authentication","Connection"]),angular.module("Navigation",["Authentication","Profiles","Authorization"]),angular.module("Profiles",["Authentication","ui.bootstrap","ui.mask","Connection"]),angular.module("Home",["Authentication","Authorization","pdf","Connection"]),angular.module("Administration",["Authentication","Connection"]),angular.module("Search",["Authentication","Authorization","Connection","ui.bootstrap"]),angular.module("Muster",["Authentication","Authorization","Profiles","Connection"]),angular.module("Modals",["angularModalService"]),angular.module("CommandCentral",["Administration","Authentication","Authorization","Connection","Home","Navigation","Profiles","Search","Modals","Muster","angularModalService","ngRoute","ngStorage","ui.bootstrap","ui.mask","pdf"]).config(["$routeProvider",function(a){a.when("/login/:redirectURL",{controller:"LoginController",templateUrl:"modules/authentication/views/login.html",hideMenus:!0}).when("/login",{controller:"LoginController",templateUrl:"modules/authentication/views/login.html",hideMenus:!0}).when("/",{controller:"HomeController",templateUrl:"modules/home/views/home.html"}).when("/createnews",{controller:"CreateNewsController",templateUrl:"modules/home/views/createnews.html"}).when("/muster",{controller:"MusterController",templateUrl:"modules/muster/views/muster.html"}).when("/muster/finalize",{controller:"FinalizeMusterController",templateUrl:"modules/muster/views/finalizemuster.html"}).when("/muster/archive/:musterDate",{controller:"MusterArchiveController",templateUrl:"modules/muster/views/archive.html"}).when("/muster/archive",{controller:"MusterArchiveController",templateUrl:"modules/muster/views/archive.html"}).when("/updatenews/:id",{controller:"UpdateNewsController",templateUrl:"modules/home/views/updatenews.html"}).when("/profile/:id",{controller:"ProfileController",templateUrl:"modules/profile/views/profile.html"}).when("/search",{controller:"SearchController",templateUrl:"modules/search/views/search.html"}).when("/search/:searchTerms/:showHidden",{controller:"SearchController",templateUrl:"modules/search/views/search.html"}).when("/searchbyfield",{controller:"SearchByFieldController",templateUrl:"modules/search/views/searchbyfield.html"}).when("/searchbyfield/:searchTerms/:returnFields/:searchLevel/:showHidden",{controller:"SearchByFieldController",templateUrl:"modules/search/views/searchbyfield.html"}).when("/register",{controller:"RegisterController",templateUrl:"modules/authentication/views/register.html",hideMenus:!0}).when("/finishregistration/:id",{controller:"FinishRegisterController",templateUrl:"modules/authentication/views/finishregister.html",hideMenus:!0}).when("/forgotpassword",{controller:"ForgotController",templateUrl:"modules/authentication/views/forgotpassword.html",hideMenus:!0}).when("/changepassword",{controller:"ChangePasswordController",templateUrl:"modules/authentication/views/changepassword.html",hideMenus:!0}).when("/finishreset/:id",{controller:"FinishResetController",templateUrl:"modules/authentication/views/finishreset.html",hideMenus:!0}).when("/createuser",{controller:"CreateUserController",templateUrl:"modules/authentication/views/createuser.html",hideMenus:!0}).when("/editpermissions/:id",{controller:"EditPermissionGroupsController",templateUrl:"modules/authorization/views/permissions.html",hideMenus:!0}).when("/admin/editlists",{controller:"ListEditorController",templateUrl:"modules/administration/views/listeditor.html",hideMenus:!0}).when("/admin/editcommands",{controller:"CommandEditorController",templateUrl:"modules/administration/views/commandeditor.html",hideMenus:!0}).when("/admin/editcommands/:id",{controller:"DepartmentEditorController",templateUrl:"modules/administration/views/departmenteditor.html",hideMenus:!0}).when("/admin/editcommands/:id/:depId",{controller:"DivisionEditorController",templateUrl:"modules/administration/views/divisioneditor.html",hideMenus:!0}).otherwise({redirectTo:"/"})}]).run(["$rootScope","$location","$localStorage","$http","ConnectionService",function(a,b,c,d,e){a.globals=c.globals||{},a.globals.currentUser&&(d.defaults.headers.common.Authorization="Basic "+a.globals.currentUser.authdata),a.globals.loginMessages=[],a.globals.loginErrors=[],a.$on("$locationChangeStart",function(c,d,f){a.showNav=b.path().indexOf("/login")==-1&&b.path().indexOf("/register")==-1&&b.path().indexOf("/finishregistration")==-1&&b.path().indexOf("/forgotpassword")==-1&&b.path().indexOf("/finishreset")==-1,b.path().indexOf("/login")!=-1||"/resetlogin"===b.path()||"/register"===b.path()||b.path().indexOf("/finishregistration")!=-1||"/forgotpassword"===b.path()||b.path().indexOf("/finishreset")!=-1||a.globals.currentUser||(e.AddLoginError("You must log in to see that page"),e.SetRedirectURL(b.url()),b.path("/login"))})}]).filter("utc",function(){return function(a){var b=new Date(a);return new Date(b.getUTCFullYear(),b.getUTCMonth(),b.getUTCDate(),b.getUTCHours(),b.getUTCMinutes(),b.getUTCSeconds())}}).directive("scroll",[function(){return{link:function(a,b,c){function d(){g.width()!=h&&e()}function e(){l.width(g.width()+1),j.width(l.width()),i.scroll(function(){k.scrollLeft(i.scrollLeft())}),k.scroll(function(){i.scrollLeft(k.scrollLeft())})}var f,g=b.find("[data-anchor]"),h=g.width();b.on("remove",function(){clearInterval(f)}),b.wrapInner("<div class='div2' />"),b.wrapInner("<div class='wrapper2' />"),b.prepend("<div class='wrapper1'><div class='div1'></div></div>");var i=b.find(".wrapper1"),j=b.find(".div1"),k=b.find(".wrapper2"),l=b.find(".div2");i.css({width:"100%",border:"none 0px rgba(0, 0, 0, 0)",overflowX:"scroll",overflowY:"hidden",height:"20px"}),j.css({height:"20px"}),k.css({width:"100%",overflowX:"scroll"}),f=setInterval(function(){d()},650),e()}}}]).directive("ngCustomDatePicker",function(){return{restrict:"E",require:"^ngModel",scope:{ngModel:"=",disabled:"=ngDisabled"},template:'<div class="input-group"><input type="text" class="form-control" ng-disabled="disabled" uib-datepicker-popup="dd-MMMM-yyyy" ng-model="ngModel" is-open="opened" datepicker-options="dateOptions" close-text="Close" /><span class="input-group-btn"><button type="button" class="btn btn-default" ng-disabled="disabled" ng-click="openPicker()"><i class="glyphicon glyphicon-calendar"></i></button></span></div>',controller:["$scope",function(a){a.opened=!1,a.openPicker=function(){a.opened=!0},a.dateOptions={startingDay:1}}]}}),angular.module("Administration").controller("ListEditorController",["$scope","$rootScope","$location","$routeParams","AdministrationService","ConnectionService","config",function(a,b,c,d,e,f,g){b.containsPII=!1,a.dataLoading=!0,a.errors=[],a.blah=function(a){g.debugMode&&console.log(a)},a.loadLists=function(){e.LoadEditableLists(function(b){a.errors=[],a.dataLoading=!1,a.lists=b.ReturnValue},function(b){f.HandleServiceError(b,a,c)})},a.addListItem=function(b,d,g){a.errors=[],a.messages=[],e.AddListItem(b,d,g,function(c){a.loadLists(),a.messages.push("Item '"+d+"' successfully added to list '"+b+"'.")},function(b){f.HandleServiceError(b,a,c)})},a.deleteListItem=function(b,d){a.errors=[],a.messages=[],e.DeleteListItem(b.Id,a.selectedList,d,function(b){a.loadLists(),a.messages.push("Item successfully deleted.")},function(b){f.HandleServiceError(b,a,c)})},a.updateListItem=function(b,d){a.errors=[],a.messages=[],e.EditListItem(d.Id,d.Value,d.Description,b,function(b){a.loadLists(),a.messages.push("Item successfully updated.")},function(b){f.HandleServiceError(b,a,c)})},a.loadLists()}]).controller("CommandEditorController",["$scope","$rootScope","$location","$routeParams","AdministrationService","ConnectionService","config",function(a,b,c,d,e,f,g){b.containsPII=!1,a.dataLoading=!0,a.errors=[],a.blah=function(a){g.debugMode&&console.log(a)},a.loadCommands=function(){e.LoadCommands(function(b){a.errors=[],a.dataLoading=!1,a.commands=b.ReturnValue.Command},function(b){f.HandleServiceError(b,a,c)})},a.addCommand=function(b,d){a.errors=[],a.messages=[],e.AddCommand(b,d,function(c){a.loadCommands(),a.messages.push("Command '"+b+"' successfully added.")},function(b){f.HandleServiceError(b,a,c)})},a.deleteCommand=function(b,d){a.errors=[],a.messages=[],e.DeleteCommand(b,d,function(b){a.loadCommands(),a.messages.push("Command successfully deleted.")},function(b){f.HandleServiceError(b,a,c)})},a.updateCommand=function(b,d,g){a.errors=[],a.messages=[],e.EditCommand(b,d,g,function(b){a.loadCommands(),a.messages.push("Command successfully updated.")},function(b){f.HandleServiceError(b,a,c)})},a.loadCommands()}]).controller("DepartmentEditorController",["$scope","$rootScope","$location","$routeParams","AdministrationService","ConnectionService","config",function(a,b,c,d,e,f,g){b.containsPII=!1,a.dataLoading=!0,a.errors=[],a.blah=function(a){g.debugMode&&console.log(a)},a.commandId=d.id,e.LoadCommand(d.id,function(b){a.command=b.ReturnValue.Command},function(b){f.HandleServiceError(b,a,c)}),a.loadDepartments=function(){e.LoadDepartments(d.id,function(b){a.errors=[],a.dataLoading=!1,a.departments=b.ReturnValue.Department,g.debugMode&&console.log(b.ReturnValue.Department)},function(b){f.HandleServiceError(b,a,c)})},a.addDepartment=function(b,g){a.errors=[],a.messages=[],e.AddDepartment(d.id,b,g,function(c){a.loadDepartments(),a.messages.push("Department '"+b+"' successfully added.")},function(b){f.HandleServiceError(b,a,c)})},a.deleteDepartment=function(b,d){a.errors=[],a.messages=[],e.DeleteDepartment(b,d,function(b){a.loadDepartments(),a.messages.push("Department successfully deleted.")},function(b){f.HandleServiceError(b,a,c)})},a.updateDepartment=function(b,g,h){a.errors=[],a.messages=[],e.EditDepartment(d.id,b,g,h,function(b){a.loadDepartments(),a.messages.push("Department successfully updated.")},function(b){f.HandleServiceError(b,a,c)})},a.loadDepartments()}]).controller("DivisionEditorController",["$scope","$rootScope","$location","$routeParams","AdministrationService","ConnectionService","config",function(a,b,c,d,e,f,g){b.containsPII=!1,a.dataLoading=!0,a.errors=[],a.blah=function(a){g.debugMode&&console.log(a)},a.departmentId=d.depId,a.commandId=d.id,e.LoadDepartment(d.depId,function(b){a.department=b.ReturnValue.Department[0]},function(b){f.HandleServiceError(b,a,c)}),e.LoadCommand(d.id,function(b){a.command=b.ReturnValue},function(b){f.HandleServiceError(b,a,c)}),a.loadDivisions=function(){e.LoadDivisions(d.depId,function(b){a.errors=[],a.dataLoading=!1,a.divisions=b.ReturnValue.Division},function(b){f.HandleServiceError(b,a,c)})},a.addDivision=function(b,g){a.errors=[],a.messages=[],e.AddDivision(d.depId,b,g,function(c){a.loadDivisions(),a.messages.push("Division '"+b+"' successfully added.")},function(b){f.HandleServiceError(b,a,c)})},a.deleteDivision=function(b,d){a.errors=[],a.messages=[],e.DeleteDivision(b,d,function(b){a.loadDivisions(),a.messages.push("Division successfully deleted.")},function(b){f.HandleServiceError(b,a,c)})},a.updateDivision=function(b,g,h){a.errors=[],a.messages=[],e.EditDivision(d.depId,b,g,h,function(b){a.loadDivisions(),a.messages.push("Division successfully updated.")},function(b){f.HandleServiceError(b,a,c)})},a.loadDivisions()}]),angular.module("Administration").factory("AdministrationService",["$http","$localStorage","$rootScope","$timeout","AuthenticationService","ConnectionService",function(a,b,c,d,e,f){var g={};return g.LoadEditableLists=function(a,b){return f.RequestFromBackend("LoadReferenceLists",{editable:!0,exclude:!0,entitynames:["Division","Department","Command"]},a,b)},g.AddListItem=function(a,b,c,d,g){return f.RequestFromBackend("UpdateOrInsertReferenceList",{authenticationtoken:e.GetAuthToken(),entityname:a,item:{value:b,description:c}},d,g)},g.EditListItem=function(a,b,c,d,g,h){return f.RequestFromBackend("UpdateOrInsertReferenceList",{authenticationtoken:e.GetAuthToken(),entityname:d,item:{value:b,description:c,id:a}},g,h)},g.DeleteListItem=function(a,b,c,d,g){return f.RequestFromBackend("DeleteReferenceList",{authenticationtoken:e.GetAuthToken(),forcedelete:c,entityname:b,id:a},d,g)},g.LoadCommands=function(a,b){return f.RequestFromBackend("LoadReferenceLists",{authenticationtoken:e.GetAuthToken(),entitynames:["Command"]},a,b)},g.AddCommand=function(a,b,c,d){return f.RequestFromBackend("UpdateOrInsertReferenceList",{authenticationtoken:e.GetAuthToken(),entityname:"Command",item:{value:a,description:b}},c,d)},g.EditCommand=function(a,b,c,d,g){return f.RequestFromBackend("UpdateOrInsertReferenceList",{authenticationtoken:e.GetAuthToken(),entityname:"Command",id:a,item:{value:b,description:c,id:a}},d,g)},g.DeleteCommand=function(a,b,c,d){return f.RequestFromBackend("DeleteReferenceList",{authenticationtoken:e.GetAuthToken(),entityname:"Command",forcedelete:b,id:a},c,d)},g.LoadCommand=function(a,b,c){return f.RequestFromBackend("LoadReferenceLists",{authenticationtoken:e.GetAuthToken(),entitynames:["Command"],id:a},b,c)},g.LoadDepartments=function(a,b,c){return f.RequestFromBackend("LoadReferenceLists",{authenticationtoken:e.GetAuthToken(),entitynames:["Department"],commandid:a},b,c)},g.AddDepartment=function(a,b,c,d,g){return f.RequestFromBackend("UpdateOrInsertReferenceList",{authenticationtoken:e.GetAuthToken(),entityname:"Department",item:{commandid:a,value:b,description:c}},d,g)},g.EditDepartment=function(a,b,c,d,g,h){return f.RequestFromBackend("UpdateOrInsertReferenceList",{authenticationtoken:e.GetAuthToken(),entityname:"Department",item:{value:c,description:d,id:b,commandid:a}},g,h)},g.DeleteDepartment=function(a,b,c,d){return f.RequestFromBackend("DeleteReferenceList",{authenticationtoken:e.GetAuthToken(),entityname:"Department",forcedelete:b,id:a},c,d)},g.LoadDepartment=function(a,b,c){return f.RequestFromBackend("LoadReferenceLists",{authenticationtoken:e.GetAuthToken(),entitynames:["Department"],id:a},b,c)},g.LoadDivisions=function(a,b,c){return f.RequestFromBackend("LoadReferenceLists",{authenticationtoken:e.GetAuthToken(),entitynames:["Division"],departmentid:a},b,c)},g.AddDivision=function(a,b,c,d,g){return f.RequestFromBackend("UpdateOrInsertReferenceList",{authenticationtoken:e.GetAuthToken(),entityname:"Division",item:{departmentid:a,value:b,description:c}},d,g)},g.EditDivision=function(a,b,c,d,g,h){return f.RequestFromBackend("UpdateOrInsertReferenceList",{authenticationtoken:e.GetAuthToken(),entityname:"Division",item:{value:c,description:d,id:b,departmentid:a}},g,h)},g.DeleteDivision=function(a,b,c,d){return f.RequestFromBackend("DeleteReferenceList",{authenticationtoken:e.GetAuthToken(),entityname:"Division",forcedelete:b,id:a},c,d)},g.LoadDivision=function(a,b,c){return f.RequestFromBackend("LoadReferenceLists",{authenticationtoken:e.GetAuthToken(),entitynames:["Division"],id:a},b,c)},g}]),angular.module("Authentication").controller("LoginController",["$scope","$rootScope","$location","$routeParams","AuthenticationService","AuthorizationService","ModalService","ConnectionService","config",function(a,b,c,d,e,f,g,h,i){e.ClearCredentials(),a.errors=h.GetLoginErrors(),a.messages=h.GetLoginMessages(),h.ClearLoginErrors(),h.ClearLoginMessages(),a.login=function(){a.dataLoading=!0,a.errors=[],g.showModal({templateUrl:"modules/modals/views/privacyact.html",controller:"ModalController"}).then(function(b){b.element.modal(),b.close.then(function(b){b?e.Login(a.username,a.password,function(b){i.debugMode&&console.log(b),e.SetCredentials(a.username,b.ReturnValue.AuthenticationToken,b.ReturnValue.PersonId),f.SetPermissions(b.ReturnValue.ResolvedPermissions),f.GetPermissionGroups(function(a){f.SetPermissionGroups(a.ReturnValue)},function(b){h.HandleServiceError(b,a,c)}).then(function(){var a=h.GetRedirectURL();h.ClearRedirectURL(),i.debugMode&&console.log(a),c.path(a)})},function(b){if("Authentication"==b.ErrorType||"Authorization"==b.ErrorType){for(var d=0;d<b.ErrorMessages.length;d++)h.AddLoginError("The service returned an error: "+b.ErrorMessages[d]);e.ClearCredentials(),c.path("/login"),a.errors=h.GetLoginErrors(),h.ClearLoginErrors()}else a.errors=b.ErrorMessages;a.dataLoading=!1}):(a.dataLoading=!1,a.errors.push("You must accept the Privacy Act Statement to continue"))})})}}]).controller("RegisterController",["$scope","$rootScope","$location","AuthenticationService","ConnectionService","config",function(a,b,c,d,e,f){a.accepted=null,a.beginRegistration=function(){a.dataLoading=!0,d.BeginRegistration(a.password,function(b){a.accepted=!0,a.dataLoading=!1},function(b){e.HandleServiceError(b,a,c)})}}]).controller("FinishRegisterController",["$scope","$rootScope","$location","$routeParams","AuthenticationService","ConnectionService","config",function(a,b,c,d,e,f,g){a.finishRegistration=function(){a.dataLoading=!0,e.FinishRegistration(a.username,a.password,d.id,function(a){f.AddLoginMessage("Account created. Login with your new account"),c.path("/login")},function(b){f.HandleServiceError(b,a,c)})}}]).controller("ChangePasswordController",["$scope","$rootScope","$location","AuthenticationService","ConnectionService","config",function(a,b,c,d,e,f){a.changePassword=function(){a.dataLoading=!0,d.ChangePassword(a.oldPassword,a.newPassword,function(a){e.AddLoginMessage("Password successfully changed. Please log in with your new password."),c.path("/login")},function(b){e.HandleServiceError(b,a,c)})}}]).controller("FinishResetController",["$scope","$rootScope","$location","$routeParams","AuthenticationService","ConnectionService","config",function(a,b,c,d,e,f,g){a.finishReset=function(){a.dataLoading=!0,e.FinishReset(a.password,d.id,function(a){f.AddLoginMessage("Password reset. Please login with your new password."),c.path("/login")},function(b){f.HandleServiceError(b,a,c)})}}]).controller("CreateUserController",["$scope","$rootScope","$location","$routeParams","AuthenticationService","ProfileService","ConnectionService","config",function(a,b,c,d,e,f,g,h){a.errors=[],a.messages=[],f.GetAllLists(function(b){a.lists=b.ReturnValue},function(b){g.HandleServiceError(b,a,c)}),a.trimString=function(a){return a?a.replace(/^\s+|\s+$/g,""):""},a.isValidSSN=function(a){var b=/^\d{3}-?\d{2}-?\d{4}$/;return b.test(a)},a.createUser=function(){a.errors=[],a.messages=[],a.dataLoading=!0,e.CreateUser(a.newUser,function(b){a.messages.push("User created. Please instruct them to register their account."),a.dataLoading=!1,c.path("/profile/"+b.ReturnValue)},function(b){g.HandleServiceError(b,a,c)})}}]),angular.module("Authentication").factory("AuthenticationService",["$http","$localStorage","$rootScope","$timeout","ConnectionService",function(a,b,c,d,e){var f={};return f.Login=function(a,b,c,d){return e.RequestFromBackend("Login",{username:a,password:b},c,d)},f.Logout=function(a,b){return e.RequestFromBackend("Logout",{authenticationtoken:f.GetAuthToken()},a,b)},f.FinishRegistration=function(a,b,c,d,f){return e.RequestFromBackend("CompleteRegistration",{username:a,password:b,accountconfirmationid:c},d,f)},f.BeginRegistration=function(a,b,c){return e.RequestFromBackend("BeginRegistration",{ssn:a,continuelink:"https://commandcentral/#/finishregistration/"},b,c)},f.CreateUser=function(a,b,c){return e.RequestFromBackend("CreatePerson",{authenticationtoken:f.GetAuthToken(),person:a},b,c)},f.ForgotPassword=function(a,b,c,d){return e.RequestFromBackend("BeginPasswordReset",{email:a,ssn:b,continuelink:"https://commandcentral/#/finishreset/"},c,d)},f.FinishReset=function(a,b,c,d){return e.RequestFromBackend("CompletePasswordReset",{PasswordResetid:b,Password:a},c,d)},f.ChangePassword=function(a,b,c,d){return e.RequestFromBackend("ChangePassword",{authenticationtoken:f.GetAuthToken(),oldpassword:a,newpassword:b},c,d)},f.SetCredentials=function(a,d,e){c.globals={currentUser:{username:a,authtoken:d,userID:e}},b.globals=c.globals},f.ClearCredentials=function(){delete c.globals.currentUser,delete b.globals},f.GetAuthToken=function(){return b.globals&&b.globals.currentUser&&b.globals.currentUser.authtoken?b.globals.currentUser.authtoken:null},f.GetCurrentUserID=function(){return c.globals&&c.globals.currentUser&&c.globals.currentUser.userID?c.globals.currentUser.userID:null},f}]),angular.module("Authorization").controller("AuthorizationController",["$scope","$rootScope","$location","$routeParams","AuthenticationService",function(a,b,c,d,e){}]).controller("EditPermissionGroupsController",["$scope","$rootScope","$location","$routeParams","AuthenticationService","AuthorizationService","ConnectionService","config",function(a,b,c,d,e,f,g,h){f.GetUserPermissionGroups(d.id,function(b){a.errors=[],a.messages=[],a.personId=d.id,a.friendlyName=b.ReturnValue.FriendlyName,a.allPermissionGroups=b.ReturnValue.AllPermissionGroups,h.debugMode&&console.log(a.allPermissionGroups),a.userPermissionGroups=b.ReturnValue.CurrentPermissionGroups,h.debugMode&&console.log(a.userPermissionGroups),a.editablePermissionGroups=b.ReturnValue.EditablePermissionGroups,a.givePermissionGroup=function(b){for(var c=0;c<a.userPermissionGroups.length;c++)if(a.userPermissionGroups[c]==b)return void a.errors.push("User already has this permission.");a.userPermissionGroups.push(b)},a.removePermissionGroup=function(b){for(var c=0;c<a.userPermissionGroups.length;c++)a.userPermissionGroups[c]==b&&a.userPermissionGroups.splice(c,1)},a.canEditPermissionGroup=function(b){for(var c=0;c<a.editablePermissionGroups.length;c++)if(a.editablePermissionGroups[c]==b)return!0;return!1},a.updatePermissions=function(){a.errors=[],a.messages=[],f.UpdateUserPermissionGroups(d.id,a.userPermissionGroups,function(b){a.messages.push("Permissions successfully updated."),b.ReturnValue.WasSelf&&(g.AddLoginError("Your permissions have changed. Please re-login."),g.ClearCredentials(),c.path("/login"))},function(b){g.HandleServiceError(b,a,c)})}},function(b){g.HandleServiceError(b,a,c)})}]),angular.module("Authorization").factory("AuthorizationService",["$http","$localStorage","$rootScope","$timeout","AuthenticationService","ConnectionService","config",function(a,b,c,d,e,f,g){var h={};return h.GetUserPermissionGroups=function(a,b,c){return f.RequestFromBackend("LoadPermissionGroupsByPerson",{authenticationtoken:e.GetAuthToken(),personid:a},b,c)},h.UpdateUserPermissionGroups=function(a,b,c,d){return f.RequestFromBackend("UpdatePermissionGroupsByPerson",{authenticationtoken:e.GetAuthToken(),personid:a,permissiongroups:b},c,d)},h.GetPersonMetadata=function(a,b){return f.RequestFromBackend("GetPersonMetadata",{authenticationtoken:e.GetAuthToken()},a,b)},h.GetPermissionGroups=function(a,b){return f.RequestFromBackend("LoadPermissionGroups",{authenticationtoken:e.GetAuthToken()},a,b)},h.CanCreatePerson=function(){try{return c.globals.currentUser.permissions.AccessibleSubmodules.indexOf("CreatePerson")!=-1}catch(a){return!1}},h.CanEditNews=function(){try{return c.globals.currentUser.permissions.AccessibleSubmodules.indexOf("EditNews")!=-1}catch(a){return!1}},h.CanUseAdminTools=function(){try{return c.globals.currentUser.permissions.AccessibleSubmodules.indexOf("AdminTools")!=-1}catch(a){return!1}},h.SetPermissions=function(a){c.globals.currentUser.permissions=a,b.globals=c.globals},h.SetPermissionGroups=function(a){c.globals.currentUser.permissionGroups=a,b.globals=c.globals},h.GetReturnableFields=function(a){var b=c.globals.currentUser.permissions.ReturnableFields.Main.Person,d=c.globals.currentUser.permissions.PrivelegedReturnableFields.Main[a],e=b.concat(d.filter(function(a){return b.indexOf(a)<0})),f=e.indexOf(a);return g.debugMode&&console.log(a),g.debugMode&&console.log(f),f>=0&&e.splice(f,1),e},h}]),angular.module("Connection").controller("SetPortController",["$scope","$rootScope","ConnectionService","config",function(a,b,c,d){a.setPort=function(b){c.SetBackendPort(b),a.currentURL=a.getCurrentUrl()},a.getCurrentUrl=function(){return c.GetBackendURL()},a.currentURL=a.getCurrentUrl(),a.showPortController=d.debugMode}]),angular.module("Connection").factory("ConnectionService",["$http","$localStorage","$rootScope","config",function(a,b,c,d){var e,f={},g="",h=d.apiKey,i=d.backendURL;e=b.backendPort?b.backendPort:d.backendPort,d.debugMode||(e=d.backendPort);var j=i+":"+e;return f.GetBackendURL=function(){return i+":"+e},f.SetBackendPort=function(a){e=a,j=i+":"+e,b.backendPort=a},f.GetAPIKey=function(){return h},f.AddLoginMessage=function(a){c.globals.loginMessages?c.globals.loginMessages.push(a):c.globals.loginMessages=[a]},f.ClearLoginMessages=function(){c.globals.loginMessages=[]},f.GetLoginMessages=function(){return c.globals.loginMessages},f.SetRedirectURL=function(a){g=a},f.ClearRedirectURL=function(){g=""},f.GetRedirectURL=function(){return g},f.AddLoginError=function(a){c.globals.loginErrors?c.globals.loginErrors.push(a):c.globals.loginErrors=[a]},f.ClearLoginErrors=function(){c.globals.loginErrors=[]},f.GetLoginErrors=function(){return c.globals.loginErrors},f.ClearCredentials=function(){delete c.globals.currentUser,delete b.globals},f.HandleServiceError=function(a,b,c){if("Authentication"==a.ErrorType||"Authorization"==a.ErrorType){for(var d=0;d<a.ErrorMessages.length;d++)f.AddLoginError("The service returned an error: "+a.ErrorMessages[d]);f.ClearCredentials(),f.SetRedirectURL(c.url()),c.path("/login")}else b.errors=a.ErrorMessages;b.dataLoading=!1},f.RequestFromBackend=function(b,c,e,g){var h={apikey:f.GetAPIKey()};for(var i in c)h[i]=c[i];var j=f.GetBackendURL()+"/"+b,k={method:"POST",url:j,data:h,headers:{"Content-Type":"application/json;charset=utf-8;"}};return a(k).then(function(a){e(f.RestoreJsonNetReferences(JSON.parse(a.data))),d.debugMode&&console.log(b),d.debugMode&&console.log(f.RestoreJsonNetReferences(a.data))},function(a){g(""==a.statusText?{ErrorType:"Authentication",ErrorMessages:["The service is offline. If this message persists, please contact the developers."]}:f.RestoreJsonNetReferences(JSON.parse(a.data)))})},f.RestoreJsonNetReferences=function(a){function b(a,e){if("object"!=typeof a||!a)return a;var f=e.slice();if(a.hasOwnProperty("$values")){var g=[];f.push(a.$id);for(var h in a.$values)g.push(b(a.$values[h],f));return c[a.$id]=g,g}if("$id"in a){var i=a.$id;delete a.$id,f.push(i);for(var j in a)a[j]=b(a[j],f);return c[i]=a,a}if("$ref"in a){if(f.indexOf(a.$ref)!=-1)return{};if(a.$ref in c)return c[a.$ref];d.push(a)}for(var k in a)a[k]=b(a[k],f);return a}"string"==typeof a&&(a=JSON.parse(a));var c={},d=[];for(var e in d)d[e]=c[d[e].$ref];return b(a,[])},f}]),angular.module("Home").controller("HomeController",["$scope","$rootScope","$location","$routeParams","AuthenticationService","AuthorizationService","HomeService","ConnectionService","config",function(a,b,c,d,e,f,g,h,i){a.pdfUrl="/img/pow.pdf",a.refreshNews=function(){a.dataLoading=!0,a.errors=null,g.GetHomeNews(function(b){a.dataLoading=!1,a.newsItems=b.ReturnValue,a.loadedTime=new Date},function(b){h.HandleServiceError(b,a,c)})},a.deleteNewsItem=function(b){a.dataLoading=!0,a.errors=null,g.DeleteNewsItem(b,function(b){a.refreshNews()},function(b){h.HandleServiceError(b,a,c)})},a.userCanEditNews=function(){return f.CanEditNews()},a.refreshNews()}]).controller("CreateNewsController",["$scope","$rootScope","$location","AuthenticationService","HomeService","ConnectionService",function(a,b,c,d,e,f){a.saveNewsItem=function(b,d){e.CreateNewsItem(b,d.match(/[^\r\n]+/g),function(b){a.dataLoading=!1,c.path("/")},function(b){f.HandleServiceError(b,a,c)})}}]).controller("UpdateNewsController",["$scope","$rootScope","$location","$routeParams","AuthenticationService","HomeService","ConnectionService",function(a,b,c,d,e,f,g){a.dataLoading=!0,a.errors=null,f.LoadNewsItem(d.id,function(b){a.dataLoading=!1,a.newsItem=b.ReturnValue,a.text=a.newsItem.Paragraphs.join("\n")},function(b){g.HandleServiceError(b,a,c)}),a.updateNewsItem=function(b,d){a.errors=null,a.dataLoading=!0;var e={};e.Paragraphs=d.match(/[^\r\n]+/g),e.Title=b.Title,e.NewsItemId=b.Id,f.UpdateNewsItem(e,function(b){a.dataLoading=!1,c.path("/")},function(b){g.HandleServiceError(b,a,c)})}}]),angular.module("Home").factory("HomeService",["$http","$localStorage","$rootScope","$timeout","AuthenticationService","ConnectionService",function(a,b,c,d,e,f){var g={};return g.GetHomeNews=function(a,b){return f.RequestFromBackend("LoadNewsItems",{authenticationtoken:e.GetAuthToken()},a,b)},g.LoadNewsItem=function(a,b,c){return f.RequestFromBackend("LoadNewsItem",{authenticationtoken:e.GetAuthToken(),newsitemid:a},b,c)},g.CreateNewsItem=function(a,b,c,d){return f.RequestFromBackend("CreateNewsItem",{authenticationtoken:e.GetAuthToken(),Title:a,Paragraphs:b},c,d)},g.UpdateNewsItem=function(a,b,c){return f.RequestFromBackend("UpdateNewsItem",{authenticationtoken:e.GetAuthToken(),newsitemid:a.NewsItemId,paragraphs:a.Paragraphs,title:a.Title},b,c)},g.DeleteNewsItem=function(a,b,c){return f.RequestFromBackend("DeleteNewsItem",{authenticationtoken:e.GetAuthToken(),newsitemid:a},b,c)},g}]),angular.module("Modals").controller("ModalServiceController",["$scope","ModalService",function(a,b){a.show=function(){return b.showModal({templateUrl:"modules/modals/views/pii.html",controller:"ModalController"}).then(function(b){b.element.modal(),b.close.then(function(b){a.message="You said "+b})},function(b){b.element.modal(),b.close.then(function(b){a.message="You said "+b})},function(b){b.element.modal(),b.close.then(function(b){a.message="You said "+b})})},a.show()}]).controller("ModalController",["$scope","close",function(a,b){a.close=function(a){b(a,250),$(".modal-backdrop").hide()}}]),angular.module("Muster").controller("MusterController",["$scope","$filter","$rootScope","$location","$routeParams","AuthenticationService","AuthorizationService","MusterService","ProfileService","ConnectionService","config",function(a,b,c,d,e,f,g,h,i,j,k){c.containsPII=!0,a.divisions=[],a.fields=["FriendlyName","Paygrade","Division","HasBeenMustered"],a.errors=[],a.messages=[];var l=[];a.itemsPerPage="50",a.currentPage=1,a.displaySailorsList=[],a.pageCount=function(){return Math.ceil(a.friends.length/a.itemsPerPage)},a.$watch("currentPage + itemsPerPage + setOrder + displaySailorsList + orderKey + showUnmustered",function(){var c=(parseInt(a.currentPage,10)-1)*parseInt(a.itemsPerPage,10),d=parseInt(c,10)+parseInt(a.itemsPerPage,10);a.displaySailorsList=b("orderBy")(a.displaySailorsList,a.orderKey),a.showUnmustered?a.filteredDisplaySailorsList=b("filter")(a.displaySailorsList,{HasBeenMustered:!1}).slice(c,d):a.filteredDisplaySailorsList=a.displaySailorsList.slice(c,d),a.unmusteredSailorsList=[];for(var e in a.displaySailorsList)a.displaySailorsList[e].HasBeenMustered||a.unmusteredSailorsList.push(a.displaySailorsList[e])}),a.orderKey="Division",a.selectedDivision="All",a.setDivision=function(b){if(a.displaySailorsList=[],"All"==b)a.displaySailorsList=a.allSailorsList;else for(var c=0;c<a.allSailorsList.length;c++)a.allSailorsList[c].Division==b&&a.displaySailorsList.push(a.allSailorsList[c])},i.GetAllLists(function(b){a.musterStatuses=b.ReturnValue.MusterStatus},function(b){j.HandleServiceError(b,a,d)});var m=function(){a.dataLoading=!0,h.LoadTodaysMuster(function(c){a.dataLoading=!1;for(var d=0;d<c.ReturnValue.Musters.length;d++)a.divisions.indexOf(c.ReturnValue.Musters[d].Division)==-1&&a.divisions.push(c.ReturnValue.Musters[d].Division);a.displaySailorsList=c.ReturnValue.Musters,a.allSailorsList=c.ReturnValue.Musters;for(var e in a.displaySailorsList)l[e]={CurrentMusterStatus:{MusterStatus:a.displaySailorsList[e].CurrentMusterStatus.MusterStatus}};var f=(a.currentPage-1)*a.itemsPerPage,g=f+a.itemsPerPage;a.displaySailorsList=b("orderBy")(a.displaySailorsList,a.orderKey),a.filteredDisplaySailorsList=a.displaySailorsList.slice(f,g),a.unmusteredSailorsList=[];for(var e in a.displaySailorsList)a.displaySailorsList[e].HasBeenMustered||a.unmusteredSailorsList.push(a.displaySailorsList[e])},function(b){j.HandleServiceError(b,a,d)})};m(),a.submitMuster=function(b){var c={};console.log(b);for(var e=0;e<b.length;e++)null!=b[e].CurrentMusterStatus.MusterStatus&&b[e].CurrentMusterStatus.MusterStatus!=l[e].CurrentMusterStatus.MusterStatus&&(c[b[e].Id]=b[e].CurrentMusterStatus.MusterStatus);
return a.messages=[],a.errors=[],k.debugMode&&console.log(c),JSON.stringify(c)===JSON.stringify({})?void a.errors.push("No muster records altered"):void h.SubmitMuster(c,function(b){a.messages.push("Muster successfully submitted. Please wait for updated muster to load before submitting more changes."),m()},function(b){j.HandleServiceError(b,a,d)})},a.setOrder=function(b){a.orderKey==b?a.orderKey="-"+b:a.orderKey=b}}]).controller("MusterArchiveController",["$scope","$rootScope","$location","$routeParams","AuthenticationService","AuthorizationService","MusterService","ProfileService","ConnectionService","config",function(a,b,c,d,e,f,g,h,i,j){a.musterDate=new Date,a.musterDate.setDate(a.musterDate.getDate()-1),a.viewBy="division",a.goToMuster=function(b,d,e){c.path("/muster/archive/"+a.musterDate)};var k=function(b){a.errors=[],a.dataLoading=!0,g.LoadMusterByDay(b,function(b){if(a.dataLoading=!1,j.debugMode&&console.log(b),0==b.ReturnValue.length)a.errors.push("No muster records for that date.");else{a.showProgress=!0,a.musterCounts={Present:0,Terminal_Leave:0,Leave:0,UA:0,SIQ:0,Transferred:0,Total:b.ReturnValue.length},a.command={name:b.ReturnValue[0].Command,departments:{},uics:{}};for(var c in b.ReturnValue){var d=b.ReturnValue[c];a.musterCounts[d.MusterStatus]+=1,a.command.departments[d.Department]||(a.command.departments[d.Department]={}),a.command.departments[d.Department][d.Division]||(a.command.departments[d.Department][d.Division]=[]),a.command.departments[d.Department][d.Division].push(d),d.UIC||(d.UIC="NONE"),a.command.uics[d.UIC]||(a.command.uics[d.UIC]=[]),a.command.uics[d.UIC].push(d)}}},function(b){i.HandleServiceError(b,a,c)})};d.musterDate&&(a.musterDate=new Date(d.musterDate.replace(/\"/g,""))),k(a.musterDate)}]).controller("FinalizeMusterController",["$scope","$rootScope","$location","$routeParams","AuthenticationService","AuthorizationService","MusterService","ProfileService","ConnectionService","config",function(a,b,c,d,e,f,g,h,i,j){a.errors=[],a.messages=[],a.finalizeMuster=function(){a.dataLoading=!0,a.errors=[],a.messages=[],g.FinalizeMuster(function(){a.dataLoading=!1,a.messages.push("Muster successfully finalized.")},function(b){i.HandleServiceError(b,a,c)})}}]).filter("yesNo",function(){return function(a){return a?"Yes":"No"}}),angular.module("Muster").factory("MusterService",["$http","$localStorage","$rootScope","$timeout","AuthenticationService","ConnectionService",function(a,b,c,d,e,f){var g={};return g.LoadTodaysMuster=function(a,b){return f.RequestFromBackend("LoadMusterablePersonsForToday",{authenticationtoken:e.GetAuthToken()},a,b)},g.SubmitMuster=function(a,b,c){return f.RequestFromBackend("SubmitMuster",{authenticationtoken:e.GetAuthToken(),mustersubmissions:a},b,c)},g.LoadMusterByDay=function(a,b,c){return f.RequestFromBackend("LoadMusterRecordsByMusterDay",{authenticationtoken:e.GetAuthToken(),musterdate:a},b,c)},g.FinalizeMuster=function(a,b){return f.RequestFromBackend("FinalizeMuster",{authenticationtoken:e.GetAuthToken()},a,b)},g}]),angular.module("Navigation").controller("NavController",["$scope","$rootScope","$location","$routeParams","AuthenticationService","ProfileService","AuthorizationService","ConnectionService",function(a,b,c,d,e,f,g,h){a.resetPIIBanner=function(){b.containsPII=!1},a.canCreatePerson=function(){return g.CanCreatePerson()},a.canUseAdminTools=function(){return g.CanUseAdminTools()},a.createNewPerson=function(){f.CreatePerson(function(b){c.path("/profile/"+b.ReturnValue),a.dataLoading=!1},function(b){h.HandleServiceError(b,a,c)})},a.logout=function(){h.AddLoginMessage("Succesfully logged out!"),e.Logout(function(a){e.ClearCredentials(),c.path("/login")},function(b){h.HandleServiceError(b,a,c)})},a.isMyProfileActive=function(){return d.id===e.GetCurrentUserID()},a.getMyProfileURL=function(){return e.GetCurrentUserID()?"#/profile/"+e.GetCurrentUserID():null},a.canFinalizeMuster=function(){return!0},a.isActive=function(a){return a===c.path()}}]),angular.module("Profiles").controller("ProfileController",["$scope","$rootScope","$location","$routeParams","AuthenticationService","ProfileService","ConnectionService","config",function(a,b,c,d,e,f,g,h){a.loadProfile=function(){a.dataLoading=!0,a.errors=[],a.getByName=function(a,b){if(a)for(var c=0,d=a.length;c<d;c++)if(a[c].Name===b)return a[c];return null},a.getById=function(a,b){if(a)for(var c=0,d=a.length;c<d;c++)if(a[c].Id===b)return a[c];return null},f.LoadProfile(d.id,function(c){b.containsPII=!0,a.dataLoading=!1,a.friendlyName=c.ReturnValue.FriendlyName,a.profileData=c.ReturnValue.Person,a.isMyProfile=c.ReturnValue.IsMyProfile,a.returnableFields=c.ReturnValue.ResolvedPermissions.ReturnableFields.Main.Person,a.editableFields=c.ReturnValue.ResolvedPermissions.EditableFields.Main.Person,c.ReturnValue.Person.DateOfBirth&&(a.profileData.DateOfBirth=new Date(c.ReturnValue.Person.DateOfBirth)),c.ReturnValue.Person.DateOfArrival&&(a.profileData.DateOfArrival=new Date(c.ReturnValue.Person.DateOfArrival)),c.ReturnValue.Person.DateOfDeparture&&(a.profileData.DateOfDeparture=new Date(c.ReturnValue.Person.DateOfDeparture)),c.ReturnValue.Person.EAOS&&(a.profileData.EAOS=new Date(c.ReturnValue.Person.EAOS)),c.ReturnValue.Person.PRD&&(a.profileData.PRD=new Date(c.ReturnValue.Person.PRD)),c.ReturnValue.Person.ClaimTime&&(a.profileData.ClaimTime=new Date(c.ReturnValue.Person.ClaimTime)),a.canSearchPersonField=function(b){return"currentUser"in a.globals&&a.globals.currentUser.permissions.searchable.indexOf(b)>-1},a.canReturnPersonField=function(b){return a.returnableFields.indexOf(b)>-1},a.canEditPersonField=function(b){return a.editableFields.indexOf(b)>-1}},function(b){g.HandleServiceError(b,a,c)}).then(function(){f.TakeLock(d.id,function(b){a.haveLock=!0,a.profileLock=b.ReturnValue,a.$on("$locationChangeStart",function(b){if(a.profileLock){var d=a.profileLock.Id;a.profileLock=null,f.ReleaseLock(d,!1,function(a){},function(b){g.HandleServiceError(b,a,c)})}})},function(b){g.HandleServiceError(b,a,c)}),f.GetCommands(function(b){a.commandList=b.ReturnValue.Command,a.command=a.getById(b.ReturnValue.Command,a.profileData.Command),a.profileData.Command=a.command,a.profileData.Command?(a.profileData.Department=a.getById(a.profileData.Command.Departments,a.profileData.Department),a.profileData.Department?a.profileData.Division=a.getById(a.profileData.Department.Divisions,a.profileData.Division):a.profileData.Division=null):a.profileData.Department=null,h.debugMode&&console.log(a.form.$error)},function(b){g.HandleServiceError(b,a,c)})})},f.GetAllLists(function(b){a.lists=b.ReturnValue},function(b){g.HandleServiceError(b,a,c)}),a.loadProfile(),a.loadFullAccountHistory=function(){f.LoadAccountHistory(a.profileData.Id,function(b){a.profileData.AccountHistory=b.ReturnValue},function(b){g.HandleServiceError(b,a,c)})},a.updateProfile=function(){a.dataLoading=!0,a.profileUpdateSuccess=!1,f.UpdateMyProfile(a.profileData,function(b){a.profileUpdateSuccess=!0,a.form.$setPristine(),a.loadProfile()},function(b){g.HandleServiceError(b,a,c)})},a.makePreferred=function(a,b){for(var c=0;c<a.length;++c)a[c].IsPreferred=!1;return a[a.indexOf(b)].IsPreferred=!0,a},a.makeHome=function(a,b){for(var c=0;c<a.length;++c)a[c].IsHomeAddress=!1;return a[a.indexOf(b)].IsHomeAddress=!0,a},a.addNewNumber=function(b,c,d,e){if(e)for(var f=0;f<a.profileData.PhoneNumbers.length;++f)a.profileData.PhoneNumbers[f].IsPreferred=!1;a.profileData.PhoneNumbers.push({Number:b,PhoneType:c,IsContactable:d,IsPreferred:e})},a.addNewEmail=function(b,c,d){if(d)for(var e=0;e<a.profileData.EmailAddresses.length;++e)a.profileData.EmailAddresses[e].IsPreferred=!1;a.profileData.EmailAddresses.push({Address:b,IsContactable:c,IsPreferred:d})},a.addNewAddress=function(b,c,d,e,f,g){if(g)for(var h=0;h<a.profileData.PhysicalAddresses.length;++h)a.profileData.PhysicalAddresses[h].IsHomeAddress=!1;a.profileData.PhysicalAddresses.push({Address:b,City:c,State:d,ZipCode:e,Country:f,IsHomeAddress:g})},a.isValidEmail=function(a){var b=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return b.test(a)},a.isValidPhoneNumber=function(a){var b=/^(?:(?:\+?1\s*(?:[.-]\s*)?)?(?:\(\s*([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9])\s*\)|([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9]))\s*(?:[.-]\s*)?)?([2-9]1[02-9]|[2-9][02-9]1|[2-9][02-9]{2})\s*(?:[.-]\s*)?([0-9]{4})(?:\s*(?:#|x\.?|ext\.?|extension)\s*(\d+))?$/;return b.test(a)},a.isValidSSN=function(a){var b=/^\d{3}-?\d{2}-?\d{4}$/;return b.test(a)},a.trimString=function(a){return a?a.replace(/^\s+|\s+$/g,""):""}}]),angular.module("Profiles").factory("ProfileService",["$http","$localStorage","$rootScope","$timeout","AuthenticationService","ConnectionService",function(a,b,c,d,e,f){var g={};return g.GetAllLists=function(a,b){return f.RequestFromBackend("LoadReferenceLists",{enititynames:[]},a,b)},g.GetPermissionGroups=function(a,b){return f.RequestFromBackend("LoadPermissionGroups",{},a,b)},g.GetCommands=function(a,b){return f.RequestFromBackend("LoadReferenceLists",{acceptcachedresults:!0,entitynames:["Command"]},a,b)},g.UpdateMyProfile=function(a,b,c){return f.RequestFromBackend("UpdatePerson",{authenticationtoken:e.GetAuthToken(),person:a},b,c)},g.CreatePerson=function(a,b){return f.RequestFromBackend("CreatePerson",{authenticationtoken:e.GetAuthToken()},a,b)},g.TakeLock=function(a,b,c){return f.RequestFromBackend("TakeProfileLock",{authenticationtoken:e.GetAuthToken(),personid:a},b,c)},g.ReleaseLock=function(a,b,c,d){return f.RequestFromBackend("ReleaseProfileLock",{authenticationtoken:e.GetAuthToken(),profilelockid:a,forcerelease:b},c,d)},g.LoadProfile=function(a,b,c){return f.RequestFromBackend("LoadPerson",{authenticationtoken:e.GetAuthToken(),personid:a},b,c)},g.LoadAccountHistory=function(a,b,c){return f.RequestFromBackend("LoadAccountHistoryByPerson",{authenticationtoken:e.GetAuthToken(),personid:a},b,c)},g}]),angular.module("Search").controller("SearchController",["$scope","$filter","$rootScope","$location","$routeParams","AuthenticationService","AuthorizationService","SearchService","config",function(a,b,c,d,e,f,g,h,i){c.containsPII=!0,a.Math=window.Math,a.itemsPerPage=50,a.currentPage=1,a.results=[],e.showHidden?a.showHidden=JSON.parse(e.showHidden):a.showHidden=!1,a.pageCount=function(){return Math.ceil(a.friends.length/a.itemsPerPage)},a.$watch("currentPage + itemsPerPage + setOrder + orderKey",function(){var c=(parseInt(a.currentPage,10)-1)*parseInt(a.itemsPerPage,10),d=parseInt(c,10)+parseInt(a.itemsPerPage,10);a.results=b("orderBy")(a.results,a.orderKey),a.filteredResults=a.results.slice(c,d)}),a.goToProfile=function(a){d.path("/profile/"+a)},a.goToResults=function(b){d.path("/search/"+b+"/"+JSON.stringify(a.showHidden))},a.searchOnEnter=function(b,c){13===b.keyCode&&a.goToResults(c)},a.orderKey="LastName",a.setOrder=function(b){a.orderKey==b?a.orderKey="-"+b:a.orderKey=b};var j=function(c,e){a.dataLoading=!0,a.errors=[],h.DoSimpleSearch(c,a.showHidden,function(c){a.dataLoading=!1,a.results=c.ReturnValue.Results,a.fields=c.ReturnValue.Fields;var d=(a.currentPage-1)*a.itemsPerPage,e=d+a.itemsPerPage;a.results=b("orderBy")(a.results,a.orderKey),a.filteredResults=a.results.slice(d,e),0==a.results.length&&a.errors.push("No results for that query.")},function(b){ConnectionService.HandleServiceError(b,a,d)})};e.searchTerms&&(j(e.searchTerms),a.simpleSearchTerms=e.searchTerms)}]).controller("SearchByFieldController",["$scope","$filter","$rootScope","$location","$routeParams","AuthenticationService","AuthorizationService","SearchService","ConnectionService","config",function(a,b,c,d,e,f,g,h,i,j){c.containsPII=!0,a.searchLevels=["Command","Department","Division"],a.selectedLevel="Command",a.orderKey="LastName",e.showHidden?a.showHidden=JSON.parse(e.showHidden):a.showHidden=!1,a.setOrder=function(b){a.orderKey==b?a.orderKey="-"+b:a.orderKey=b},a.itemsPerPage=50,a.currentPage=1,a.results=[],a.pageCount=function(){return Math.ceil(a.friends.length/a.itemsPerPage)},a.$watch("currentPage + itemsPerPage + setOrder + orderKey",function(){var c=(parseInt(a.currentPage,10)-1)*parseInt(a.itemsPerPage,10),d=parseInt(c,10)+parseInt(a.itemsPerPage,10);a.results=b("orderBy")(a.results,a.orderKey),a.filteredResults=a.results.slice(c,d)}),a.getSearchableFields=function(a){return j.debugMode&&console.log(g.GetReturnableFields(a)),g.GetReturnableFields(a)},a.getReturnableFields=function(a){return g.GetReturnableFields(a)},a.advancedSearchFilters={},a.goToProfile=function(a){d.path("/profile/"+a)},a.goToResults=function(b,c,f){null==f&&(f=e.searchLevel,null==f&&(f="Command")),f=f.replace(/['"]+/g,"");for(var g in b)""!=b[g]&&a.fieldsToSearch.indexOf(g)!=-1||delete b[g];d.path("/searchbyfield/"+JSON.stringify(b)+"/"+JSON.stringify(c)+"/"+JSON.stringify(f)+"/"+JSON.stringify(a.showHidden))},a.searchOnEnter=function(b,c,d,e){13===b.keyCode&&a.goToResults(c,d,e)};var k=function(c,e,f){a.dataLoading=!0,a.errors=[],null==f&&(f="Command"),h.DoAdvancedSearch(c,e,f,a.showHidden,function(c){a.dataLoading=!1,a.results=c.ReturnValue.Results,a.fields=c.ReturnValue.Fields;var d=(a.currentPage-1)*a.itemsPerPage,e=d+a.itemsPerPage;a.results=b("orderBy")(a.results,a.orderKey),a.filteredResults=a.results.slice(d,e),0==a.results.length&&a.errors.push("No results for that query.")},function(b){i.HandleServiceError(b,a,d)})};e.searchTerms&&e.returnFields&&e.searchLevel&&(k(JSON.parse(e.searchTerms),JSON.parse(e.returnFields),JSON.parse(e.searchLevel)),a.searchByFieldTerms=JSON.parse(e.searchTerms),a.searchByFieldReturns=JSON.parse(e.returnFields),a.fieldsToReturn=JSON.parse(e.returnFields),a.fieldsToSearch=Object.keys(JSON.parse(e.searchTerms)),a.advancedSearchFilters=a.searchByFieldTerms,a.selectedLevel=JSON.parse(e.searchLevel),j.debugMode&&console.log(JSON.parse(e.searchTerms)),j.debugMode&&console.log(JSON.parse(e.returnFields)))}]),angular.module("Search").factory("SearchService",["$http","$localStorage","$rootScope","$timeout","AuthenticationService","ConnectionService",function(a,b,c,d,e,f){var g={};return g.DoSimpleSearch=function(a,b,c,d){return f.RequestFromBackend("SimpleSearchPersons",{authenticationtoken:e.GetAuthToken(),searchterm:a,showhidden:b},c,d)},g.DoAdvancedSearch=function(a,b,c,d,g,h){return f.RequestFromBackend("AdvancedSearchPersons",{authenticationtoken:e.GetAuthToken(),filters:a,returnfields:b,searchLevel:c,showhidden:d},g,h)},g}]);